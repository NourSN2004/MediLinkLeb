{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pharmacy Dashboard - {{ pharmacy_name }}</title>
  <link rel="stylesheet" href="{% static 'css/styles.css' %}">
  <style>
    :root{ --sidebar-w:260px; --transition:.25s ease; }
    html,body{ height:100%; margin:0; background:#f8fafc; }
    
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateX(-10px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }
    
    @keyframes pulse {
      0%, 100% {
        opacity: 1;
      }
      50% {
        opacity: 0.8;
      }
    }
    
    @keyframes shimmer {
      0% {
        background-position: -1000px 0;
      }
      100% {
        background-position: 1000px 0;
      }
    }
    
    .app{ 
      height:100vh; width:100vw; display:grid; 
      grid-template-columns:var(--sidebar-w) 1fr; 
      transition:var(--transition); overflow:hidden; 
    }
    .app.is-collapsed{ grid-template-columns:72px 1fr; }
    
    /* Sidebar Styles */
    .sidebar{ 
      background:#fff; border-right:1px solid var(--line); 
      display:flex; flex-direction:column; overflow:hidden; 
      transition:var(--transition); 
    }
    .brand{ 
      display:flex; align-items:center; gap:.6rem; 
      padding:1rem; border-bottom:1px solid var(--line); 
      transition:var(--transition);
    }
    .brand .logo{ 
      width:36px; height:36px; border-radius:10px; 
      display:grid; place-items:center; 
      background:linear-gradient(135deg,#10b981,#059669); 
      color:#fff; font-weight:800; 
      transition: transform 0.3s ease;
      flex-shrink: 0;
    }
    .brand .logo:hover {
      transform: rotate(360deg);
    }
    .brand h1{ 
      font-size:1.05rem; margin:0; letter-spacing:.2px;
      white-space: nowrap; overflow: hidden;
      transition: opacity 0.2s ease, width 0.25s ease;
    }
    
    .side-section{ 
      padding:.75rem 1rem; flex:1; overflow-y:auto;
      transition: padding 0.25s ease;
    }
    .side-title{ 
      font-size:.8rem; font-weight:800; 
      color:var(--ink-dim); margin:.4rem 0 .3rem; 
      text-transform:uppercase; letter-spacing:.5px;
      white-space: nowrap; overflow: hidden;
      transition: opacity 0.2s ease;
    }
    .nav{ display:flex; flex-direction:column; gap:.4rem; }
    .nav a{ 
      display:flex; align-items:center; gap:.55rem; 
      padding:.7rem .6rem; border-radius:10px; 
      color:var(--ink); text-decoration:none; 
      border:1px solid transparent; 
      transition:all .25s ease;
      font-weight:600;
      font-size: 0.9375rem;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      position: relative;
      overflow: hidden;
      min-height: 42px;
      box-sizing: border-box;
    }
    .nav a svg {
      flex-shrink: 0;
      width: 22px;
      height: 22px;
      transition: transform 0.3s ease;
    }
    .nav a:hover svg {
      transform: scale(1.1);
    }
    .nav a span.label {
      white-space: nowrap;
      transition: opacity 0.2s ease;
      line-height: 1.4;
    }
    .nav a:hover{ 
      background:#f1f5f9; 
      border-color:var(--line);
      transform: translateX(4px);
    }
    .nav a.primary,
    .nav a.active{ 
      background:linear-gradient(135deg,#10b981,#059669); 
      color:#fff !important;
      font-weight:700;
      border-color: transparent;
    }
    .nav a.primary:hover,
    .nav a.active:hover{ 
      filter:brightness(1.05);
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
      transform: translateX(4px);
    }
    
    .collapse-btn{ 
      border-top:1px solid var(--line); 
      padding:.6rem 1rem;
      transition: padding 0.25s ease;
    }
    .collapse-btn button{ 
      width:100%; border:1px solid var(--line); 
      background:#fff; color:var(--ink); padding:.6rem; 
      border-radius:10px; cursor:pointer; font-weight:700; 
      transition:all .25s ease;
      white-space:nowrap;
    }
    .collapse-btn button:hover{ 
      background:#f8fafc;
      transform: scale(1.02);
    }
    
    /* Collapsed State */
    .app.is-collapsed .brand h1{ 
      opacity: 0;
      width: 0;
    }
    .app.is-collapsed .side-title{ 
      opacity: 0;
      height: 0;
      margin: 0;
    }
    .app.is-collapsed .nav a span.label{ 
      opacity: 0;
      width: 0;
    }
    .app.is-collapsed .nav a{ 
      justify-content:center; 
      padding:.7rem;
    }
    .app.is-collapsed .nav a:hover {
      transform: translateX(0) scale(1.05);
    }
    .app.is-collapsed .brand{ 
      justify-content:center;
      padding: 1rem 0.5rem;
    }
    .app.is-collapsed .side-section{ 
      padding:.75rem .5rem;
    }
    .app.is-collapsed .collapse-btn {
      padding: .6rem .5rem;
    }
    .app.is-collapsed .collapse-btn button {
      padding: .6rem;
      font-size: 0;
      position: relative;
    }
    .app.is-collapsed .collapse-btn button::before {
      content: "→";
      font-size: 1.2rem;
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
    }
    
    /* Hide user profile in collapsed state */
    .app.is-collapsed .user-profile {
      display: none;
    }

    /* Main Content */
    .main{ 
      display:grid; grid-template-rows:auto 1fr; 
      height:100%; overflow:hidden;
    }
    
    .topbar{ 
      background:#fff; border-bottom:1px solid var(--line); 
      display:flex; align-items:center; justify-content:space-between; 
      gap:1rem; padding:.75rem 1.5rem;
      animation: fadeInUp 0.3s ease;
    }
    .top-left{ display:flex; align-items:center; gap:1rem; }
    .hamburger{ 
      display:none; width:38px; height:38px; 
      border-radius:10px; border:1px solid var(--line); 
      background:#fff; cursor:pointer;
      transition: all 0.3s ease;
    }
    .hamburger:hover {
      background: #f1f5f9;
      transform: rotate(90deg);
    }
    .top-title{ 
      font-weight:800; font-size:1.1rem; color:var(--ink);
      animation: slideIn 0.4s ease;
    }
    .top-right{ 
      display:flex; align-items:center; gap:.9rem;
      animation: slideIn 0.5s ease;
    }
    .avatar{ 
      width:36px; height:36px; border-radius:999px; 
      display:grid; place-items:center; color:#fff; 
      background:linear-gradient(135deg,#10b981,#059669); 
      font-weight:800; font-size:.9rem;
      transition: transform 0.3s ease;
      cursor: pointer;
    }
    .avatar:hover {
      transform: scale(1.1) rotate(5deg);
    }

    /* Content Grid */
    .content{ 
      display:grid; grid-template-columns:2fr 1fr; gap:1.2rem; 
      height:100%; overflow:auto; padding:1.2rem; background:#f8fafc; 
    }
    
    /* Panel Styles - Matching Doctor's Design */
    .panel{ 
      background:#fff; border:1px solid var(--line); 
      border-radius:12px; 
      box-shadow:0 2px 4px rgba(0,0,0,.05); 
      display:flex; flex-direction:column; 
      animation: fadeInUp 0.5s ease;
    }
    .panel .head{ 
      padding:.9rem 1rem; border-bottom:1px solid var(--line); 
      display:flex; align-items:center; justify-content:space-between; 
    }
    .panel .head h2{ font-size:1rem; margin:0; font-weight:800; }
    .panel .body{ padding:.9rem 1rem; flex:1; overflow-y:auto; }
    
    /* Medicine List Items - Like Doctor's Appointments */
    .med-list{ display:flex; flex-direction:column; gap:.65rem; }
    .med-item{ 
      border:1px solid var(--line); border-radius:12px; 
      padding:.85rem .9rem; display:flex; 
      justify-content:space-between; align-items:center; 
      gap:.5rem; background:#fff; transition:all .3s ease; 
      text-decoration:none; color:inherit;
      animation: slideIn 0.4s ease forwards;
      opacity: 0;
    }
    .med-item:nth-child(1) { animation-delay: 0.1s; }
    .med-item:nth-child(2) { animation-delay: 0.2s; }
    .med-item:nth-child(3) { animation-delay: 0.3s; }
    .med-item:nth-child(4) { animation-delay: 0.4s; }
    .med-item:nth-child(5) { animation-delay: 0.5s; }
    .med-item:hover{ 
      box-shadow:0 0 0 4px rgba(16,185,129,.15); 
      border-color:#10b981;
      transform: translateY(-2px);
    }
    .med-item .left{ display:flex; align-items:center; gap:.8rem; }
    .med-item .left svg{ color:#10b981; flex-shrink:0; }
    .med-name{ font-weight:800; margin-bottom:.2rem; }
    .med-details{ font-size:.85rem; color:var(--ink-dim); }
    
    /* Pills/Badges */
    .pill{ 
      padding:.2rem .55rem; border-radius:999px; 
      border:1px solid var(--line-2); font-size:.82rem; 
      color:#0b1221; background:#f8fafc; display:inline-block;
      font-weight:600; margin-right:.4rem;
      transition: all 0.3s ease;
      cursor: default;
    }
    .pill:hover {
      transform: translateY(-1px);
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .pill.green{ 
      background:#d1fae5; color:#065f46; 
      border-color:#6ee7b7; 
    }
    .pill.green:hover {
      background:#a7f3d0;
    }
    .pill.orange{ 
      background:#fed7aa; color:#92400e; 
      border-color:#fbbf24; 
    }
    .pill.orange:hover {
      background:#fbbf24;
    }
    .pill.red{ 
      background:#fee2e2; color:#991b1b; 
      border-color:#fca5a5; 
      animation: pulse 2s ease-in-out infinite;
    }
    .pill.red:hover {
      background:#fca5a5;
      animation: none;
    }
    
    /* Stats Info */
    .stat-info{ 
      display:flex; align-items:center; gap:.35rem; 
      color:var(--ink-dim); font-weight:700; font-size:.9rem;
      transition: color 0.3s ease;
    }
    .stat-info svg {
      transition: transform 0.3s ease;
    }
    .med-item:hover .stat-info svg {
      transform: rotate(360deg);
    }
    
    /* Muted Empty State */
    .muted{ 
      color:var(--ink-dim); text-align:center; 
      padding:1.2rem 0; border:1px dashed var(--line-2); 
      border-radius:12px; background:#f8fafc;
      animation: fadeInUp 0.6s ease;
    }
    
    /* Quick Stats Grid */
    .stats-grid{
      display:grid; grid-template-columns:repeat(2, 1fr);
      gap:.8rem; margin-bottom:1.2rem;
    }
    .stat-box{
      background:#fff; border:1px solid var(--line);
      border-radius:12px; padding:1rem;
      display:flex; align-items:center; gap:.8rem;
      transition: all 0.3s ease;
      animation: fadeInUp 0.5s ease forwards;
      opacity: 0;
    }
    .stat-box:nth-child(1) { animation-delay: 0.1s; }
    .stat-box:nth-child(2) { animation-delay: 0.2s; }
    .stat-box:nth-child(3) { animation-delay: 0.3s; }
    .stat-box:nth-child(4) { animation-delay: 0.4s; }
    .stat-box:hover {
      transform: translateY(-3px);
      box-shadow: 0 4px 12px rgba(0,0,0,.1);
    }
    .stat-box .icon{
      width:44px; height:44px; border-radius:10px;
      display:grid; place-items:center;
      background:linear-gradient(135deg,#d1fae5,#a7f3d0);
      transition: transform 0.3s ease;
    }
    .stat-box:hover .icon {
      transform: scale(1.1) rotate(5deg);
    }
    .stat-box .icon svg{ color:#059669; }
    .stat-box .info{ flex:1; }
    .stat-box .label{ 
      font-size:.8rem; color:var(--ink-dim); 
      font-weight:700; text-transform:uppercase;
    }
    .stat-box .value{ 
      font-size:1.5rem; font-weight:800; 
      color:var(--ink); margin-top:.1rem;
    }
    
    @media (max-width:1020px){ 
      .content{ grid-template-columns:1fr; } 
      .hamburger{ display:block; } 
      .stats-grid{ grid-template-columns:repeat(2, 1fr); }
    }
    
    .btn-ghost {
      border: 1px solid var(--line);
      background: #fff;
      color: var(--ink);
      padding: .45rem .7rem;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 700;
      font-size: 0.875rem;
      font-family: inherit;
      transition: all .25s ease;
      white-space: nowrap;
    }
    .btn-ghost:hover {
      background: #f1f5f9;
      transform: translateY(-1px);
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    /* Auth link styling */
    .auth-link {
      color: var(--brand1);
      text-decoration: none;
      font-weight: 700;
      font-size: 0.875rem;
      transition: all 0.3s ease;
      padding: 0.25rem 0.5rem;
      border-radius: 6px;
    }
    .auth-link:hover {
      background: rgba(16, 185, 129, 0.1);
      transform: translateX(2px);
    }
  </style>
</head>
<body>
  <div class="app" id="appShell">
    <aside class="sidebar">
      <div class="brand">
        <div class="logo">RX</div>
        <h1>Medilink</h1>
      </div>
      <div class="side-section">
        <div class="side-title">Quick Actions</div>
        <nav class="nav">
          <a href="{% url 'pharmacy_home' %}" class="primary">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
            </svg>
            <span class="label">Dashboard</span>
          </a>
          <a href="{% url 'add_medicine' %}">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <polyline points="14 2 14 8 20 8"></polyline>
              <line x1="12" y1="18" x2="12" y2="12"></line>
              <line x1="9" y1="15" x2="15" y2="15"></line>
            </svg>
            <span class="label">Add Medicine</span>
          </a>
          <a href="{% url 'update_stock' %}">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
              <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
            </svg>
            <span class="label">Update Stock</span>
          </a>
          <a href="{% url 'view_inventory' %}">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M4 7h16M4 12h16M4 17h10"></path>
            </svg>
            <span class="label">View Full Inventory</span>
          </a>
        </nav>
      </div>
      
      <div class="side-section user-profile" style="margin-top:auto; padding-top:0;">
        <div class="side-title">Pharmacist</div>
        <div style="display:flex; align-items:center; gap:.6rem; padding:.6rem; background:#f8fafc; border-radius:10px;">
          <div class="avatar" style="width:32px; height:32px; font-size:.8rem;">AY</div>
          <div style="flex:1; min-width:0;">
            <div style="font-weight:800; font-size:.85rem; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Ahmad Yateem</div>
            <div style="font-size:.75rem; color:var(--ink-dim);">Head Pharmacist</div>
          </div>
        </div>
      </div>
      
      <div class="collapse-btn">
        <button type="button" id="toggleBtn">Collapse Sidebar</button>
      </div>
    </aside>

    <section class="main">
      <header class="topbar">
        <div class="top-left">
          <button class="hamburger" id="hamburger" aria-label="Toggle sidebar">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="3" y1="6" x2="21" y2="6"></line>
              <line x1="3" y1="12" x2="21" y2="12"></line>
              <line x1="3" y1="18" x2="21" y2="18"></line>
            </svg>
          </button>
          <div class="top-title">Pharmacy Dashboard</div>
        </div>
        <div class="top-right">
          <div class="avatar">{{ pharmacy_name|first|upper }}</div>
          <div>
            <div style="font-weight:800;">{{ pharmacy_name }}</div>
            <small style="color:var(--ink-dim);">{{ today }}</small>
          </div>
          {% if request.user.is_superuser %}
          <form action="{% url 'populate_pharmacies' %}" method="post" style="margin-left:.5rem;">
            {% csrf_token %}
            <button type="submit" title="Populate demo data for all pharmacies"
                    style="background:linear-gradient(135deg,var(--brand1),var(--brand2));
                           color:#fff; border:none; padding:.5rem .9rem; border-radius:8px;
                           font-weight:800; cursor:pointer; transition:.15s;">
              Populate Demo
            </button>
          </form>
          {% endif %}
          <form action="{% url 'logout' %}" method="post" style="margin-left:.5rem;">
            {% csrf_token %}
            <button type="submit" class="btn-ghost">Sign out</button>
          </form>
        </div>
      </header>

      <div class="content">
        <div class="panel">
          <div class="head">
            <h2>Critical Medicines</h2>
            <a href="{% url 'view_inventory' %}" class="auth-link">View all</a>
          </div>
          <div class="body">
            {% if critical_medicines %}
              <div class="med-list">
                {% for med in critical_medicines %}
                  <a href="{% url 'view_inventory' %}" class="med-item">
                    <div class="left">
                      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                        <circle cx="12" cy="10" r="3"></circle>
                      </svg>
                      <div>
                        <div class="med-name">{{ med.name }}</div>
                        <div class="med-details">
                          <span class="pill {% if med.quantity <= 5 %}red{% elif med.quantity <= 10 %}orange{% else %}green{% endif %}">
                            {{ med.quantity }} units
                          </span>
                          {{ med.form }} • {{ med.strength }}
                        </div>
                      </div>
                    </div>
                    <div class="stat-info">
                      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <path d="M12 6v6l4 2"></path>
                      </svg>
                      Exp: {{ med.expiry_date|date:"M d" }}
                    </div>
                  </a>
                {% endfor %}
              </div>
            {% else %}
              <div class="muted">No critical medicines at this time.</div>
            {% endif %}
          </div>
        </div>

        <div class="panel">
          <div class="head">
            <h2>Inventory Stats</h2>
          </div>
          <div class="body">
            <div class="stats-grid">
              <div class="stat-box">
                <div class="icon">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                    <circle cx="12" cy="10" r="3"></circle>
                  </svg>
                </div>
                <div class="info">
                  <div class="label">Total Items</div>
                  <div class="value">{{ total_medicines|default:"0" }}</div>
                </div>
              </div>
              
              <div class="stat-box">
                <div class="icon">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="1" y="3" width="15" height="13"></rect>
                    <path d="M16 8h6v11H6v-3"></path>
                  </svg>
                </div>
                <div class="info">
                  <div class="label">In Stock</div>
                  <div class="value">{{ total_stock_quantity|default:"0" }}</div>
                </div>
              </div>
              
              <div class="stat-box">
                <div class="icon" style="background:linear-gradient(135deg,#fed7aa,#fbbf24);">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="color:#92400e;">
                    <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                    <line x1="12" y1="9" x2="12" y2="13"></line>
                    <line x1="12" y1="17" x2="12.01" y2="17"></line>
                  </svg>
                </div>
                <div class="info">
                  <div class="label">Low Stock</div>
                  <div class="value">{{ low_stock_count|default:"0" }}</div>
                </div>
              </div>
              
              <div class="stat-box">
                <div class="icon" style="background:linear-gradient(135deg,#fee2e2,#fca5a5);">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="color:#991b1b;">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="15" y1="9" x2="9" y2="15"></line>
                    <line x1="9" y1="9" x2="15" y2="15"></line>
                  </svg>
                </div>
                <div class="info">
                  <div class="label">Expiring</div>
                  <div class="value">{{ expiring_count|default:"0" }}</div>
                </div>
              </div>
            </div>
            
            <p class="muted" style="border:0; background:transparent; padding:.5rem 0;">
              Last updated: {{ today }}
            </p>
          </div>
        </div>
      </div>
    </section>
  </div>

  <script>
    const app = document.getElementById('appShell');
    const btn = document.getElementById('toggleBtn');
    const burger = document.getElementById('hamburger');
    
    function toggle() {
      app.classList.toggle('is-collapsed');
      const isCollapsed = app.classList.contains('is-collapsed');
      
      // Update button text only when not collapsed
      if (!isCollapsed) {
        btn.textContent = 'Collapse Sidebar';
      } else {
        btn.textContent = 'Expand';
      }
      
      // Save state to localStorage
      localStorage.setItem('sidebarCollapsed', isCollapsed);
    }
    
    // Restore saved state on page load
    window.addEventListener('DOMContentLoaded', () => {
      const savedState = localStorage.getItem('sidebarCollapsed');
      if (savedState === 'true') {
        app.classList.add('is-collapsed');
        btn.textContent = 'Expand';
      }
      
      // Mark current page as active
      const currentPath = window.location.pathname;
      const navLinks = document.querySelectorAll('.nav a');
      navLinks.forEach(link => {
        const linkPath = new URL(link.href).pathname;
        if (linkPath === currentPath) {
          link.classList.add('active');
          link.classList.remove('primary');
        } else {
          link.classList.remove('active');
          link.classList.remove('primary');
        }
      });
    });
    
    if (btn) btn.addEventListener('click', toggle);
    if (burger) burger.addEventListener('click', toggle);
  </script>
</body>
</html> 
