{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Doctor Dashboard</title>
  <link rel="stylesheet" href="{% static 'css/styles.css' %}">
  <style>
    :root{ --sidebar-w:260px; --transition:.25s ease; }
    html,body{ height:100%; margin:0; background:#f8fafc; }
    .app{ height:100vh; width:100vw; display:grid; grid-template-columns:var(--sidebar-w) 1fr; transition:var(--transition); overflow:hidden; }
    .app.is-collapsed{ grid-template-columns:72px 1fr; }
    .sidebar{ background:#fff; border-right:1px solid var(--line); display:flex; flex-direction:column; overflow:hidden; transition:var(--transition); }
    .brand{ display:flex; align-items:center; gap:.6rem; padding:1rem; border-bottom:1px solid var(--line); }
    .brand .logo{ width:36px; height:36px; border-radius:10px; display:grid; place-items:center; background:linear-gradient(135deg,var(--brand1),var(--brand2)); color:#fff; font-weight:800; }
    .brand h1{ font-size:1.05rem; margin:0; letter-spacing:.2px; }
    .side-section{ padding:.75rem 1rem; }
    .side-title{ font-size:.8rem; font-weight:800; color:var(--ink-dim); margin:.4rem 0 .3rem; }
    .nav{ display:flex; flex-direction:column; gap:.4rem; }
    .nav a{ display:flex; align-items:center; gap:.55rem; padding:.7rem .6rem; border-radius:10px; color:var(--ink); text-decoration:none; border:1px solid transparent; }
    .nav a:hover{ background:#f1f5f9; border-color:var(--line); }
    .nav a.primary{ background:linear-gradient(135deg,var(--brand1),var(--brand2)); color:#fff; }
    .collapse-btn{ border-top:1px solid var(--line); padding:.6rem 1rem; }
    .collapse-btn button{ width:100%; border:1px solid var(--line); background:#fff; color:var(--ink); padding:.6rem; border-radius:10px; cursor:pointer; font-weight:700; }
    .app.is-collapsed .brand h1, .app.is-collapsed .side-title, .app.is-collapsed .nav a span.label{ display:none; }
    .app.is-collapsed .nav a{ justify-content:center; }

    .main{ display:grid; grid-template-rows:auto 1fr; height:100%; overflow:hidden; }
    .topbar{ background:#fff; border-bottom:1px solid var(--line); display:flex; align-items:center; justify-content:space-between; gap:1rem; padding:.75rem 1rem; }
    .top-left{ display:flex; align-items:center; gap:1rem; }
    .hamburger{ display:none; width:38px; height:38px; border-radius:10px; border:1px solid var(--line); background:#fff; cursor:pointer; }
    .top-title{ font-weight:800; font-size:1.05rem; }
    .top-right{ display:flex; align-items:center; gap:.9rem; }
    .avatar{ width:36px; height:36px; border-radius:999px; display:grid; place-items:center; color:#fff; background:linear-gradient(135deg,var(--brand1),var(--brand2)); font-weight:800; }

    .btn-ghost {
      border: 1px solid var(--line);
      background: #fff;
      color: var(--ink);
      padding: .45rem .7rem;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 700;
      transition: background .2s ease;
    }
    .btn-ghost:hover {
      background: #f1f5f9;
    }

    .content{ display:grid; grid-template-columns:2fr 1fr; gap:1.2rem; height:100%; overflow:auto; padding:1.2rem; background:#f8fafc; }
    .panel{ background:#fff; border:1px solid var(--line); border-radius:12px; box-shadow:0 2px 4px rgba(0,0,0,.05); display:flex; flex-direction:column; }
    .panel .head{ padding:.9rem 1rem; border-bottom:1px solid var(--line); display:flex; align-items:center; justify-content:space-between; }
    .panel .head h2{ font-size:1rem; margin:0; }
    .panel .body{ padding:.9rem 1rem; flex:1; overflow-y:auto; }

    .appt-list{ display:flex; flex-direction:column; gap:.65rem; }
    .appt{ border:1px solid var(--line); border-radius:12px; padding:.85rem .9rem; display:flex; justify-content:space-between; align-items:center; gap:.5rem; background:#fff; transition:.15s; }
    .appt:hover{ box-shadow:0 0 0 4px var(--focus); border-color:var(--brand2); }
    .appt .left{ display:flex; align-items:center; gap:.8rem; }
    .pill{ padding:.2rem .55rem; border-radius:999px; border:1px solid transparent; font-size:.82rem; color:#fff; background:linear-gradient(135deg,var(--brand1),var(--brand2)); box-shadow:0 1px 2px rgba(2,132,199,.15); }
    .time{ display:flex; align-items:center; gap:.35rem; color:var(--ink-dim); font-weight:700; }
    .muted{ color:var(--ink-dim); text-align:center; padding:1.2rem 0; border:1px dashed var(--line-2); border-radius:12px; background:#f8fafc; }
    .actions-small{ display:flex; align-items:center; gap:.4rem; }
    .btn-mini{ padding:.25rem .5rem; border:1px solid var(--line); border-radius:10px; font-weight:800; background:#f1f5f9; color:#0b1221; text-decoration:none; cursor:pointer; }
    .btn-mini.done{ background:#dcfce7; border-color:#bbf7d0; color:#166534; }

    @media (max-width:1020px){ .content{ grid-template-columns:1fr; } .hamburger{ display:block; } }
  </style>
</head>
<body>
  <div class="app" id="appShell">
    <aside class="sidebar">
      <div class="brand"><div class="logo">MD</div><h1>Medilink</h1></div>
      <div class="side-section">
        <div class="side-title">Quick Actions</div>
        <nav class="nav">
          <a href="{% url 'doctor_appointments' %}?tab=upcoming" class="primary">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="4" width="18" height="18" rx="2"></rect><line x1="3" y1="10" x2="21" y2="10"></line>
            </svg><span class="label">View Upcoming Appointments</span>
          </a>
          <a href="{% url 'doctor_hours' %}">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="9"></circle><path d="M12 7v5l3 3"></path>
            </svg><span class="label">Add / Edit Availability</span>
          </a>
          <a href="{% url 'doctor_new_appointment' %}">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line>
            </svg><span class="label">New Appointment</span>
          </a>
          <a href="{% url 'doctor_full_schedule' %}">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="4" width="18" height="18" rx="2"></rect><line x1="8" y1="2" x2="8" y2="6"></line><line x1="16" y1="2" x2="16" y2="6"></line>
            </svg><span class="label">View Full Schedule</span>
          </a>
          <a href="{% url 'doctor_patient_search' %}">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line>
            </svg><span class="label">Search Patient</span>
          </a>
        </nav>
      </div>
      <div class="collapse-btn"><button type="button" id="toggleBtn">Collapse Sidebar</button></div>
    </aside>

    <section class="main">
      <header class="topbar">
        <div class="top-left">
          <button class="hamburger" id="hamburger" aria-label="Toggle sidebar">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="18" x2="21" y2="18"></line>
            </svg>
          </button>
          <div class="top-title">Doctor Homepage</div>
        </div>
        <div class="top-right">
          <div class="avatar">DR</div>
          <div>
            <div style="font-weight:800;">{{ doctor_name }}</div>
            <small style="color:var(--ink-dim);">{{ today }}</small>
          </div>
          <form action="{% url 'logout' %}" method="post" style="margin-left:.5rem;">
            {% csrf_token %}
            <button type="submit" class="btn-ghost">Sign out</button>
          </form>
        </div>
      </header>

      <div class="content">
        <div class="panel">
          <div class="head"><h2>Todayâ€™s Appointments</h2><a href="{% url 'doctor_appointments' %}?tab=upcoming" class="auth-link">Open appts</a></div>
          <div class="body">
            {% if appointments %}
              <div class="appt-list">
                {% for a in appointments %}
                  <div class="appt">
                    <div class="left">
                      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle>
                      </svg>
                      <div><div style="font-weight:800">{{ a.name }}</div><div class="pill">{{ a.reason }}</div></div>
                    </div>
                    <div style="display:flex; align-items:center; gap:.6rem;">
                      <div class="time">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <circle cx="12" cy="12" r="10"></circle><path d="M12 6v6l4 2"></path>
                        </svg>{{ a.time }}</div>
                      <div class="actions-small">
                        <a class="btn-mini" href="{% url 'doctor_appointment_detail' a.id %}">View</a>
                        <form method="post" action="{% url 'doctor_appointment_complete' a.id %}">
                          {% csrf_token %}
                          <button type="submit" class="btn-mini done">Done</button>
                        </form>
                      </div>
                    </div>
                  </div>
                {% endfor %}
              </div>
            {% else %}
              <div class="muted">You have no appointments today.</div>
            {% endif %}
          </div>
        </div>

        <div class="panel">
          <div class="head"><h2>Notifications</h2><a href="#" class="auth-link">View all</a></div>
          <div class="body">
            {% if notifications %}
              <ul style="list-style:none; padding:0; margin:0; display:flex; flex-direction:column; gap:.5rem;">
                {% for n in notifications %}
                  <li style="background:#fff7ed; border:1px solid #fed7aa; color:#9a3412; padding:.55rem .7rem; border-radius:10px; font-weight:700;">{{ n.text }}</li>
                {% endfor %}
              </ul>
            {% else %}
              <p class="muted" style="border:0;background:transparent;">No new notifications.</p>
            {% endif %}
          </div>
        </div>
      </div>
    </section>
  </div>

  <script>
    const app=document.getElementById('appShell');
    const btn=document.getElementById('toggleBtn');
    const burger=document.getElementById('hamburger');
    const toggle=()=>{app.classList.toggle('is-collapsed');btn.textContent=app.classList.contains('is-collapsed')?'Expand Sidebar':'Collapse Sidebar';};
    if(btn) btn.addEventListener('click',toggle);
    if(burger) burger.addEventListener('click',toggle);
  </script>
</body>
</html>


