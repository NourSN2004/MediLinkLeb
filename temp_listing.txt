0001: {% load static %}
0002: <!DOCTYPE html>
0003: <html lang="en">
0004: <head>
0005:   <meta charset="UTF-8" />
0006:   <meta name="viewport" content="width=device-width, initial-scale=1.0" />
0007:   <title>Edit Availability</title>
0008:   <link rel="stylesheet" href="{% static 'css/styles.css' %}">
0009:   <style>
0010:     body {
0011:       background-color: var(--bg);
0012:       background-image:
0013:         radial-gradient(1200px 600px at 10% -5%, rgba(14,165,164,0.08), transparent 60%),
0014:         radial-gradient(1000px 500px at 110% 10%, rgba(2,132,199,0.08), transparent 60%),
0015:         url("data:image/svg+xml;utf8,
0016:           <svg xmlns='http://www.w3.org/2000/svg' width='160' height='160' viewBox='0 0 160 160' fill='none' stroke='%23FFFFFF' stroke-opacity='0.12' stroke-width='2'>
0017:             <g>
0018:               <path d='M20 40c0 16 12 28 28 28s28-12 28-28'/>
0019:               <path d='M76 40v26c0 17 14 30 30 30s30-13 30-30V40'/>
0020:               <circle cx='130' cy='22' r='6'/>
0021:               <path d='M18 126h24M30 114v24'/> 
0022:               <rect x='92' y='110' width='18' height='30' rx='2'/> 
0023:               <path d='M100 100v10'/> 
0024:               <path d='M56 124l10-10 10 10-10 10-10-10z'/> 
0025:             </g>
0026:           </svg>");
0027:       background-size: auto, auto, 160px 160px;
0028:     }
0029:     .section { margin-bottom:1.2rem; }
0030:     .section-title { font-weight:900; font-size:1.05rem; margin:.2rem 0; }
0031:     .section-sub { color:var(--ink-dim); font-size:.92rem; margin-bottom:.5rem; }
0032: 
0033:     .weekly-grid { display:grid; grid-template-columns: 1.1fr .9fr .9fr .9fr; gap:.55rem; align-items:center; margin-top:.6rem; }
0034:     .weekly-grid .hdr { font-size:.85rem; color:var(--ink-dim); font-weight:800; }
0035:     .toggle { display:flex; align-items:center; gap:.45rem; }
0036:     .input-toggle { width:44px; height:24px; appearance:none; -webkit-appearance:none; background:#e2e8f0; border-radius:999px; position:relative; outline:none; cursor:pointer; border:1px solid var(--line-2); }
0037:     .input-toggle:checked { background:linear-gradient(135deg,var(--brand1),var(--brand2)); border-color:transparent; }
0038:     .input-toggle::after { content:""; position:absolute; top:3px; left:3px; width:18px; height:18px; border-radius:50%; background:#fff; transition:transform .2s ease; }
0039:     .input-toggle:checked::after { transform:translateX(20px); }
0040:     .pill { display:inline-block; padding:.16rem .5rem; border-radius:999px; font-weight:800; font-size:.75rem; border:1px solid var(--line); background:#f1f5f9; color:#0b1221; }
0041:     .pill.on { background:#dcfce7; border-color:#bbf7d0; color:#166534; }
0042:     .time-input { width:100%; padding:.5rem .6rem; border:1px solid var(--line); border-radius:10px; background:var(--input-bg); }
0043:     .time-input[disabled] { opacity:.5; }
0044:     .time-input.on { border-color:#86efac; box-shadow:0 0 0 3px rgba(34,197,94,.15); }
0045:     .row { display:contents; }
0046:     .day { font-weight:800; }
0047:     .toggle { display:flex; align-items:center; gap:.45rem; }
0048:     .input-toggle { width:44px; height:24px; appearance:none; -webkit-appearance:none; background:#e2e8f0; border-radius:999px; position:relative; outline:none; cursor:pointer; border:1px solid var(--line-2); }
0049:     .input-toggle:checked { background:linear-gradient(135deg,var(--brand1),var(--brand2)); border-color:transparent; }
0050:     .input-toggle::after { content:""; position:absolute; top:3px; left:3px; width:18px; height:18px; border-radius:50%; background:#fff; transition:transform .2s ease; }
0051:     .input-toggle:checked::after { transform:translateX(20px); }
0052:     .time-input { width:100%; padding:.5rem .6rem; border:1px solid var(--line); border-radius:10px; background:var(--input-bg); }
0053:     .time-input[disabled] { opacity:.5; }
0054:     .actions { display:flex; gap:.6rem; margin-top:1rem; flex-wrap:wrap; }
0055:     .btn { padding:.6rem .9rem; border-radius:10px; border:1px solid var(--line); background:linear-gradient(135deg,var(--brand1),var(--brand2)); color:#fff; font-weight:800; cursor:pointer; }
0056:     .btn-secondary { padding:.6rem .9rem; border-radius:10px; border:1px solid var(--line); background:var(--btn-secondary-bg); color:var(--ink); font-weight:800; text-decoration:none; display:inline-grid; place-items:center; }
0057:   </style>
0058: </head>
0059: <body>
0060:   <div class="auth-container">
0061:     <div class="auth-card">
0062:       {% if messages %}
0063:         <div class="messages">
0064:           {% for message in messages %}
0065:             <div class="message message-{{ message.tags }}">{{ message }}</div>
0066:           {% endfor %}
0067:         </div>
0068:       {% endif %}
0069:       <h1 class="auth-title">Add / Edit Availability</h1>
0070:       <p class="auth-subtitle">Set your weekly hours for patient bookings. Toggle days on, then pick start/end.</p>
0071: 
0072:       <form method="post" class="section">
0073:         {% csrf_token %}
0074:         <input type="hidden" name="form" value="hours">
0075: 
0076:         <div class="weekly-grid">
0077:           <div class="hdr">Day</div>
0078:           <div class="hdr">Available</div>
0079:           <div class="hdr">Start time</div>
0080:           <div class="hdr">End time</div>
0081: 
0082:           {% for d in days %}
0083:             <div class="row">
0084:               <div class="day">{{ d.name }}</div>
0085:               <label class="toggle" title="Toggle to enable this day for bookings">
0086:                 <input class="input-toggle" type="checkbox" name="active_{{ d.num }}" id="active_{{ d.num }}" {% if d.active %}checked{% endif %}>
0087:                 <span class="pill" id="stat_{{ d.num }}">Off</span>
0088:               </label>
0089:               <input class="time-input" type="time" name="start_{{ d.num }}" id="start_{{ d.num }}" value="{{ d.start }}" placeholder="09:00">
0090:               <input class="time-input" type="time" name="end_{{ d.num }}" id="end_{{ d.num }}" value="{{ d.end }}" placeholder="17:00">
0091:             </div>
0092:           {% endfor %}
0093:         </div>
0094: 
0095:         <div class="actions">
0096:           <button type="submit" class="btn">Save Availability</button>
0097:           <button type="button" class="btn-secondary" id="preset95">Mon–Fri 09:00–17:00</button>
0098:           <button type="button" class="btn-secondary" id="clearAll">Clear all</button>
0099:           <a href="{% url 'doctor_home' %}" class="btn-secondary">Back to Dashboard</a>
0100:       </div>
0101:       </form>
0102:       <p class="section-sub">New appointments allow 30‑minute slots within your hours. Personal time off blocks override weekly hours.</p>
0103: 
0104:       <h2 class="auth-title" style="margin-top:1.1rem; font-size:1.05rem;">Personal Time Off</h2>
0105:       <p class="auth-subtitle">Block specific dates so patients cannot book during these times.</p>
0106: 
0107:       <form method="post" style="margin-top:.6rem;">
0108:         {% csrf_token %}
0109:         <input type="hidden" name="form" value="timeoff">
0110:         <div class="weekly-grid" style="grid-template-columns:1.2fr 1fr 1fr 1fr;">
0111:           <div class="hdr">Date</div>
0112:           <div class="hdr">Start time</div>
0113:           <div class="hdr">End time</div>
0114:           <div class="hdr">Reason</div>
0115:           <input class="time-input" type="date" name="to_date" min="{{ today }}" required>
0116:           <input class="time-input" type="time" name="to_start" required>
0117:           <input class="time-input" type="time" name="to_end" required>
0118:           <input class="time-input" type="text" name="to_reason" placeholder="Optional">
0119:         </div>
0120:         <div class="actions">
0121:           <button type="submit" class="btn">Add Time Off</button>
0122:         </div>
0123:       </form>
0124: 
0125:       {% if timeoffs %}
0126:         <div class="auth-subtitle" style="margin-top:1rem;">Upcoming time off</div>
0127:         <div style="margin-top:.4rem; background:var(--card); border:1px solid var(--line); border-radius:12px; overflow:hidden;">
0128:           {% for t in timeoffs %}
0129:             <div style="display:flex; align-items:center; justify-content:space-between; gap:.6rem; padding:.55rem .75rem; border-bottom:1px solid var(--line);">
0130:               <div>
0131:                 <div style="font-weight:800;">{{ t.date }} — {{ t.start_time|time:'H:i' }}–{{ t.end_time|time:'H:i' }}</div>
0132:                 {% if t.reason %}<div style="color:var(--ink-dim); font-size:.9rem;">{{ t.reason }}</div>{% endif %}
0133:               </div>
0134:               <form method="post">
0135:                 {% csrf_token %}
0136:                 <input type="hidden" name="form" value="delete_timeoff">
0137:                 <input type="hidden" name="to_id" value="{{ t.id }}">
0138:                 <button class="btn-secondary" type="submit">Remove</button>
0139:               </form>
0140:             </div>
0141:           {% endfor %}
0142:         </div>
0143:       {% endif %}
0144:     </div>
0145:   </div>
0146:   <script>
0147:     // Enable/disable time inputs based on checkbox
0148:     function syncRow(num){
0149:       const active = document.getElementById('active_'+num);
0150:       const start = document.getElementById('start_'+num);
0151:       const end = document.getElementById('end_'+num);
0152:       const stat = document.getElementById('stat_'+num);
0153:       const on = active && active.checked;
0154:       if(start){ start.disabled = !on; start.classList.toggle('on', on); }
0155:       if(end){ end.disabled = !on; end.classList.toggle('on', on); }
0156:       if(stat){ stat.textContent = on ? 'On' : 'Off'; stat.classList.toggle('on', on); }
0157:     }
0158:     const dayNums = [1,2,3,4,5,6,7];
0159:     dayNums.forEach(n=>{
0160:       const c = document.getElementById('active_'+n);
0161:       if(c){ c.addEventListener('change', ()=>syncRow(n)); syncRow(n); }
0162:     });
0163: 
0164:     // Presets
0165:     const preset = document.getElementById('preset95');
0166:     if(preset){
0167:       preset.addEventListener('click', ()=>{
0168:         [1,2,3,4,5].forEach(n=>{
0169:           const c=document.getElementById('active_'+n); if(c){ c.checked = true; }
0170:           const s=document.getElementById('start_'+n); if(s){ s.value = '09:00'; s.disabled=false; }
0171:           const e=document.getElementById('end_'+n); if(e){ e.value = '17:00'; e.disabled=false; }
0172:         });
0173:         [6,7].forEach(n=>{ const c=document.getElementById('active_'+n); if(c){ c.checked=false; } syncRow(n); });
0174:       });
0175:     }
0176:     const clearAll = document.getElementById('clearAll');
0177:     if(clearAll){
0178:       clearAll.addEventListener('click', ()=>{
0179:         dayNums.forEach(n=>{
0180:           const c=document.getElementById('active_'+n); if(c){ c.checked=false; }
0181:           const s=document.getElementById('start_'+n); if(s){ s.value=''; }
0182:           const e=document.getElementById('end_'+n); if(e){ e.value=''; }
0183:           syncRow(n);
0184:         });
0185:       });
0186:     }
0187:   </script>
0188: </body>
0189: </html>
